<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="utf-8">
    <title>SÃ¸gefunktion</title>
    <meta name="robots" content="All">
    <meta name="author" content="Udgiver">
    <meta name="copyright" content="Information om copyright">
    <link href="css/styles.css" rel="stylesheet" type="text/css">
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body class="bg-success-subtle">
<div class="container">
    <div class="row my-5 justify-content-center">
        <div class="col-md-5">
            <label class="form-label d-block text-center display-4" for="search">Hvad sÃ¸ger du? ðŸ”Ž</label>
            <div class="input-group">
                <input class="form-control mt-4" id="search" placeholder="IndsÃ¦t tekst her..">
            </div>
        </div>
    </div>
    <div id="foodContainer" class="row row-cols-auto g-3 justify-content-center"></div>

</div>

<script src="node_modules/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
<script>


    const search = document.querySelector('#search');
    const foodContainer = document.querySelector('#foodContainer');
    let max = 12;

    search.addEventListener('input', () => {
        const query = search.value.trim();

        if (query.length < 3){
            foodContainer.innerHTML = '';
            return;
        }

        // Rigtig URL-opbygning med query parameter
        const url = `https://dk.openfoodfacts.org/cgi/search.pl?search_terms=${query}&search_simple=1&action=process&json=1`;

        fetch(url)
            .then(response => response.json())
            .then(json => {
                foodContainer.innerHTML = ''; // TÃ¸m containeren for tidligere resultater

                const products = json.products || []; // Hent produkterne fra JSON

                let count = 0;

                for (const product of products) {
                    if (count >= max) break; // BegrÃ¦ns til maksimalt 10 resultater


                    // Tjekker om der findes et billede i API-dataen
                    if (!product.image_url) {
                        continue; // Hvis der ikke er noget billede, springes denne iteration over
                    }

                    const imageUrl = product.image_url;
                    const productName = product.product_name || 'Ingen navn';
                    const productBrand = product.brands || 'Ukendt mÃ¦rke';


                    const element = document.createElement('div');

                    element.innerHTML = `
                        <div class="card custom-card">
                            <img src="${imageUrl}" class="card-img-top img-fluid billede" alt="${productName}">
                            <div class="card-body">
                                <h5 class="card-title">${productName}</h5>
                                <p class="card-text">${productBrand}</p>
                            </div>
                        </div>
                    `;

                    element.addEventListener('click', () => {
                        // Vi tager data om produktet og laver det om til en streng (JSON format)
                        const productData = JSON.stringify({
                            product_name: productName,
                            image_url: imageUrl,
                            nutriments: product.nutriments // TilfÃ¸j flere data, hvis nÃ¸dvendigt
                        });

                        // Naviger til produkt.html med produktdata i query string
                        window.location.href = `produkt.html?product=${encodeURIComponent(productData)}`;
                    });



                    foodContainer.appendChild(element);
                    count++;
                }
            })
            .catch(error => console.error('Fejl ved indhentning af data:', error));
    });
</script>
</body>
</html>
